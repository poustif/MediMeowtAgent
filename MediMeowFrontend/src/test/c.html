<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>接口测试页面 (最终成功版)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        h1, h2 { color: #0056b3; text-align: center; }
        h2 { border-top: 2px solid #eee; padding-top: 25px; margin-top: 30px; font-size: 22px; }
        h3 { color: #333; font-size: 16px; margin-top: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input[type="text"], input[type="password"] { width: calc(100% - 22px); padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; width: 100%; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        .result { margin-top: 10px; padding: 15px; border-radius: 4px; background-color: #e9ecef; white-space: pre-wrap; word-break: break-all; border: 1px solid #dee2e6; font-size: 14px; min-height: 80px; }
        .result.success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .result.error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .form-section { display: flex; gap: 20px; flex-wrap: wrap; }
        .form-section > div { flex: 1; min-width: 300px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>API 综合测试面板 (最终成功版)</h1>

        <!-- 用户登录表单 -->
        <div class="test-case">
            <h2>用户登录 (/user/login)</h2>
            <form id="loginForm">
                <div class="form-group"> <label for="loginEmail">手机号 (phone_number):</label> <input type="text" id="loginEmail" required value="13850136583"> </div>
                <div class="form-group"> <label for="loginPassword">密码 (password):</label> <input type="password" id="loginPassword" required value="ShenMiDaZhi"> </div>
                <button type="submit">登录</button>
            </form>
            <h4>登录结果:</h4>
            <pre id="loginResult" class="result">等待测试...</pre>
        </div>
    </div>

<script>
    // 【最终关键改动 1】: 直接使用后端IP，彻底绕开有问题的Vite代理
    const BASE_URL = 'http://124.221.70.136:11391';
    
    // 这是一个占位的TOKEN，对于需要认证的接口是必要的
    const AUTH_TOKEN = 'your_auth_token_here_if_needed';

    /**
     * 【最终版核心请求函数】
     * 发送纯净的、不带引号的 FormData
     */
    async function requestAsFormData(url, data, fieldMap = {}, needsAuth = false) {
        
        const formData = new FormData();

        Object.keys(data).forEach(key => {
            const mappedKey = fieldMap[key] || key;
            const originalValue = data[key];
            // 发送纯净的值
            formData.append(mappedKey, originalValue);
        });

        console.log(`[最终版直接请求] 准备发送到 ${url}`);
        formData.forEach((value, key) => console.log(`  - ${key}: ${value}`));

        const headers = { 'Accept': 'application/json' };
        if (needsAuth) {
            headers['Authorization'] = `Bearer ${AUTH_TOKEN}`;
        }

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: headers, // 注意：这里不需要手动设置Content-Type
                body: formData,
            });

            const responseData = await response.json();
            const message = responseData?.base?.msg || '未知信息';

            return {
                ok: response.ok,
                status: response.status,
                data: responseData,
                message: message
            };

        } catch (error) {
            return { ok: false, status: 0, data: {}, message: `请求 Fetch 失败: ${error.message}` };
        }
    }

    // --- 用户登录事件监听 ---
    document.getElementById('loginForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const resultDiv = document.getElementById('loginResult');
        const data = {
            email: document.getElementById('loginEmail').value,
            password: document.getElementById('loginPassword').value,
        };
        const fieldMap = { email: 'phone_number' };

        resultDiv.className = 'result';
        resultDiv.textContent = '正在登录...';
        
        // 【最终关键改动 2】: URL直接拼接BASE_URL
        const finalUrl = `${BASE_URL}/user/login`;
        
        // 登录接口可能不需要认证头，所以第三个参数为false
        const { ok, status, data: responseData, message } = await requestAsFormData(finalUrl, data, fieldMap, false); 

        resultDiv.className = `result ${ok ? 'success' : 'error'}`;
        resultDiv.textContent = `请求结果 (状态码: ${status})\n信息: ${message}\n\n完整响应:\n${JSON.stringify(responseData, null, 2)}`;
    });
</script>
</body>
</html>
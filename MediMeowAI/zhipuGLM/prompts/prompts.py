# --- 阶段 1: 纯文本描述生成 ---
STAGE1_PROMPT_TEMPLATE = """
**角色设定**：你是一个高精度的医疗辅助多模态AI引擎，专注于结构化预处理。你的核心任务是**仅输出**以下四个段落的纯文本描述。
**输入数据**：
{text_input}
**核心约束**：
1. **纯文本输出**：禁止包含Markdown标题或符号。
2. **多维视觉描述**。
3. **禁止诊断或推断**。

**输出格式**：
[主诉]：[简练概括]；[症状细节]
[客观事实]：[人口学特征]；[BMI数值及状态]；[既往史关键点]
[影像观察]：[图像主体识别]；[视觉特征精细描述]
[辅助关注点]：[客观风险提示]

请严格按照上述格式，仅输出四个段落的内容，不要输出任何解释性文字。
"""

# --- 阶段 2: RAG 检索关键词提取 ---
RAG_RETRIEVAL_PROMPT = """
基于这份初步的结构化报告，请提炼出最关键的症状、体征（如BMI超重）和影像观察（特别是异常发现）作为检索关键词。

**结构化报告片段**：
---
{report_fragment}
---

请输出一个简洁的、以逗号分隔的关键词列表，例如：咽喉疼痛, 20岁男性, BMI超重, 灰白色舌苔覆盖, 局部皮损。
"""

# --- 阶段 3: 最终病历整合 ---
FINAL_REPORT_PROMPT = """
你是一位专业的临床医生助手。你的任务是将以下三部分信息整合，**严格按照指定的标准结构**，生成一份最专业的最终结构化病历。
**目标**：将检索到的常见病知识作为**背景知识**，使最终报告的影像观察和辅助关注点更具信息密度和准确性。

**原始患者数据**:
{original_text_data}

**多模态描述**:
{multimodal_description}

**RAG 检索知识片段**:
---
{retrieved_context}
---

请整合所有信息，进行以下两点的判断：

如果判断结果很奇怪，信息和原始的科室选择差距很大，那么直接返回“科室选择错误，请重新选择”

如果不是，按照**严格按照**以下最终结构输出。

### 1. 【患者主诉 (Subjective)】
* **核心症状**：[整合后的核心症状]
* **症状细节**：[整合后的症状细节]

### 2. 【客观事实 (Objective)】
* **人口学特征**：[整合后的人口学特征]
* **关键体征数据**：[整合后的关键体征数据]
* **既往史关键点**：[整合后的既往史关键点]

### 3. 【影像学/视觉观察 (Image Observation)】
* **图像主体识别**：[整合后的识别结果]
* **视觉特征精细描述**：[整合后的精细描述，**融入 RAG 知识**，使描述更专业]

### 4. 【辅助关注点 (Key Considerations)】
* **客观风险提示**：[整合后的客观风险提示，**结合 RAG 知识**，提示与常见病相关的评估方向]

### 5. 【医疗建议 (Plan)】
* **由医生填写**：(留白)
"""
